<html>
<header>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>AIO-IR system</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            margin: 0;
            padding: 0;
            text-align: center; /* !!! */
            font-size: 20px;
        }
        .centered {
            margin: 0 auto;
            text-align: left;
            width: 1600px;
        }
        .input_button{
            width: 200px;
            height: 40px;
            margin-top: 20px;
            border: 2px solid red;
            background-color: red;
            color: white;
            font-size: 15px;
        }
        .hide{
            display: none;
        }
        .page_num{
            display: inline-block;
            margin-right: 5px;
        }
        #div_page{
            text-align: center;
            margin-top: 10px;
        }
        a:link {
          text-decoration: none;
        }
        a:hover {
          color: green;
        }
        img{
            margin: 5px;
        }
        input{
            width: 500px;
        }

        /* add image button */
        #div_img {
            display: flex;
            flex-direction: row;    
            flex-wrap: wrap;
            /* height: 120px;
            width: 516px; */
        }

        .container_img_btn {
            position: relative;
            width: 100%;
            max-width: 400px;
        }

        .container_img_btn img {
            width: 100%;
            height: auto;
        }

        .container_img_btn .btn {
            position: absolute;
            top: 50%;
            left: 90%;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            background-color: #555;
            color: rgb(91, 207, 14);
            font-size: 16px;
            padding: 5px 12px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
        }

        .container_img_btn .btn_knn {
            position: absolute;
            top: 50%;
            left: 10%;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            background-color: #555;
            color: rgb(91, 207, 14);
            font-size: 16px;
            padding: 5px 12px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
        }

        .container_img_btn .btn:hover {
            background-color: black;
        }

        .container_img_btn .btn_knn:hover {
            background-color: black;
        }

    </style>

</header>
<body onload="on_load();">
    <div class="centered">
        <h1 id="imgpath"> AIO - HCM AI CHALLENGE 2022 </h1>
        <div style="height: 5px; width: 100%; background-color: black; margin-bottom: 5px;"></div>
        <div>
            Text_query: <input id="text_query"></input>
            <!-- label_img_path: <input id="imgpath"></input> -->
            <button onclick="search();">Search</button>
            <!-- <button onclick="gohome()">Home</button> -->
                
        </div>

        <div style="height: 5px; width: 100%; background-color: black; margin-bottom: 5px; margin-top: 5px;"></div>
        <div id="div_img">
            
        </div>

        <div style="height: 5px; width: 100%; background-color: black;"></div>
        <div id="div_page">
            
        </div>
        <div id="div_total_page">Total: 1200 page</div>
        <div style="margin-bottom: 50px;"></div>
    </div>
    <script>
        var data = '{{ data|tojson }}';
        data = data.replace(/\s/g, '');
        data = data.replace(/\\/g, '/');
        data = JSON.parse(data);
       
        console.log(data);
        function add_paging(){
            console.log(data['num_page']);
            var url = new URL(window.location.href);
            var cur_index = parseInt(url.searchParams.get("index"));
            var imgpath = url.searchParams.get("imgpath");
            console.log(imgpath);
            // var labelpath = url.searchParams.get("labelpath");
            if (cur_index == 'undefined'){
                cur_index = 0;
            }
            var i = cur_index-4;
            if (i > 0){
                var iDiv = document.createElement('div');
                iDiv.className = 'page_num';
                iDiv.innerHTML = "...";
                document.getElementById("div_page").appendChild(iDiv);
            }
            for (i; ((i < data['num_page']) && (i < cur_index+4)); i++){
                if (i < 0){
                    i = 0;
                }
                var iDiv = document.createElement('div');
                iDiv.className = 'page_num';
                var iA = document.createElement('a');
                // iA.href = "?index="+i.toString()+"&imgpath="+imgpath+"&labelpath="+labelpath;
                iA.href = "?index="+i.toString()+"&imgpath="+imgpath;
                iA.innerHTML = i.toString();
                if (i == cur_index){
                    iA.style.color="green";
                }
                iDiv.appendChild(iA);
                document.getElementById("div_page").appendChild(iDiv);
            }
            if (i < data['num_page']){
                var iDiv = document.createElement('div');
                iDiv.className = 'page_num';
                iDiv.innerHTML = "...";
                document.getElementById("div_page").appendChild(iDiv);
            }
            document.getElementById("div_total_page").innerHTML = "Total: "+data['num_page'].toString()+" page";
        }

        function add_img(){
            console.log(data['pagefile'].length);
            for (i = 0; i < data['pagefile'].length; i++){
                console.log(data['pagefile']);
                imgpath = data['pagefile'][i]['imgpath']
                id = data['pagefile'][i]['id']
                // labelpath = data['pagefile'][i]['labelpath']
                // fname = data['pagefile'][i]['fname']
                // fname_ext = data['pagefile'][i]['fname_ext']
                var iImg = document.createElement('img');
                // iImg.setAttribute("src", "get_img?fpath="+imgpath+fname+"&boxes="+data['pagefile'][i]['boxes']);
                iImg.setAttribute("src", "get_img?fpath="+imgpath);
                iImg.setAttribute("border", 0);
                iImg.setAttribute("alt", imgpath);
                iImg.setAttribute("width", 300);
                iImg.setAttribute("height", 180);
                // iImg.setAttribute("onclick", "go_img_search('"+id+"');");

                var box = document.createElement('button');
                box.textContent = "sellect";
                box.setAttribute('class', 'btn');
                box.setAttribute('onclick',  "go_img_search('"+id+"');");

                var box_knn = document.createElement('button');
                box_knn.textContent = "knn";
                box_knn.setAttribute('class', 'btn_knn');
                box_knn.setAttribute('onclick',  "go_img_search('"+id+"');");

                var div_image_button = document.createElement('div');
                div_image_button.setAttribute('class', 'container_img_btn');

                
                div_image_button.appendChild(box);
                div_image_button.appendChild(box_knn);
                div_image_button.appendChild(iImg);
                // iImg.appendChild(box);
                document.getElementById("div_img").appendChild(div_image_button);

                // document.getElementById("div_img").appendChild(iImg);
            }
        }

        function go_img_search(id){
            window.open("/imgsearch?imgid="+id);
        }

        function on_load(){
            var url = new URL(window.location.href);
            var imgpath = url.searchParams.get("imgpath");
            // var labelpath = url.searchParams.get("labelpath");
            document.getElementById('imgpath').value = imgpath;
            // document.getElementById('labelpath').value = labelpath;
            add_paging();
            add_img();
        }


        function search(){
            text_query = document.getElementById('text_query').value;

            window.location.href = "/textsearch?textquery="+text_query;
        }

        
    </script>
</body>
</html>